.. zephyr:board:: cytvii-b-h-8m-320-cpu

Overview
********

The cytvii-b-h-8m-320-cpu kit enables you to evaluate and develop applications using the TRAVEO™ T2G Body
High family CYT4BF device. The TRAVEO™ T2G B-H MCU is specifically designed for automotive
applications and it is a true programmable embedded system-on-chip, integrating two 350-MHz Arm®
Cortex®-M7 as the primary application processor,a 100-MHz Arm® Cortex®-M0+ that supports the
following:

- Audio Interface
- Automotive Ethernet Interface
- Gigabit Ethernet Interface
- Dual Quad SPI Flash
- HyperFlash and HyperRAM
- SD Card Interface
- User Switch and User LED
- UART Communication
- Additional features are accessible via the SAMTEC connector

The CPU board can be used as standalone board for basic validation or in combination with the
Traveo II base board (CYTVII-B-E-BB). The base board brings out all important interface
connections such as CAN, LIN, SPI EEPROM, CXPI, and FlexRay, and can be used in conjunction
with several CPU boards of the Traveo II family.Two Samtec connectors on the CPU board and
corresponding mating connectors on the base board are used to connect signals across the two boards.




Hardware
********

For more information about cytvii-b-h-8m-320-cpu:

- `cytvii-b-h-8m-320-cpu Board Website`_
- `T2G_B_H SoC Website`_

Kit Features
=============

- Evaluation board for CYT4BF MCU4 in BGA(Ball Grid Array) package with 320 pins, dual-core Arm®Cortex® M7 CPUs running at 350-MHz and an Arm® Cortex® M0+ CPU running at 100-MHz
- Fully compatible with ModusToolbox™ v3.0
- Programming interface (Arm® Standard JTAG, Cortex® Debug, Cortex Debug + ETM and Arm ETM Mictor) to connect several programming tools such as IAR I-jet, Green Hills MULTI, also Cypress MiniProg
- USB-UART interface for terminal logging
- One user switch and one user LED for standalone operation without the base board
- Dual Quad SPI Flash
- HyperFlash and HyperRAM
- Automotive Ethernet and Gigabit Ethernet Interface
- I2S Audio Codec
- SD Card Connector
- Samtec connector interface for connecting to the base board CYTVII-B-E-BB
- Evaluation board supports operating voltages 1.1V , 3.3V and 5V generated by PMIC which power the CPU board and the base
  board
- Base Board (CYTVII-B-E-BB) features following:
  - Ten CAN FD transceivers
  - Six LIN transceivers
  - Two FlexRay transceivers
  - One CXPI transceiver
  - One SPI EEPROM
  - Five user Switches and ten user LEDs
  -  Samtec connector interface for connecting to a CPU board
Supported Features
==================

.. zephyr:board-supported-hw::

Programming and Debugging
*************************

.. zephyr:board-supported-runners::

Building
========

Here is an example for building the :zephyr:code-sample:`blinky` sample application for Cortex®-M0+.

.. zephyr-app-commands::
   :zephyr-app: samples/basic/blinky
   :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m0p
   :goals: build

The same for the first Cortex®-M7 core:

.. zephyr-app-commands::
   :zephyr-app: samples/basic/blinky
   :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m7_0
   :goals: build

And the second Cortex®-M7 core:

.. zephyr-app-commands::
   :zephyr-app: samples/basic/blinky
   :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m7_1
   :goals: build

.. note:: Only Cortex®-M0+ core is enabled at startup. To enable the first Cortex®-M7 core, add the next code to Cortex®-M0+ application or soc_m0p.c : ``Cy_SysEnableCM7(CORE_CM7_0, CY_CORTEX_M7_0_APPL_ADDR);``, and the next code to enable the second Cortex®-M7 core: ``Cy_SysEnableCM7(CORE_CM7_1, CY_CORTEX_M7_1_APPL_ADDR);``.
Flashing
========

The cytvii-b-h-8m-320-cpu does not include an onboard programmer/debugger to flash/debug use the Cypress MiniProg4 , Arm Standard JTAG (20 pin connector) or any compatible programming tool.

Running on Dual Core
********************

#. Build the Zephyr kernel and the :zephyr:code-sample:`button` sample application:

   .. zephyr-app-commands::
      :zephyr-app: samples/basic/button
      :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m7_0 or m7_1
      :goals: build
      :compact:

#. To flash an image:

   .. zephyr-app-commands::
      :zephyr-app: samples/basic/button
      :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m7_0 or m7_1
      :goals: flash
      :compact:

#. Configure Cortex-M0+ to enable Cortex-M7_0/1:

   The last step flash the M7_0/1 image on the flash.  However, Cortex-M0 by default
   doesn't start the M7_0/1 and nothing will happen.  To enable Cortex-M7_0/1 CPU,
   add the following code to the M0 application or soc_m0p.c file:
   .. code-block:: c

      Cy_SysEnableCM7(CORE_CM7_0, CY_CORTEX_M7_0_APPL_ADDR);
      Cy_SysEnableCM7(CORE_CM7_1, CY_CORTEX_M7_1_APPL_ADDR);

   .. zephyr-app-commands::
      :zephyr-app: samples/hello_world
      :board: cytvii-b-h-8m-320-cpu/cyt4bfcche/m0p
      :goals: build flash
      :compact:

   Now you can press button SW-0 and see LED-0 blink at same time you have the
   "Hello World!" on your terminal.


Infineon OpenOCD Installation
=============================

Both the full `ModusToolbox`_ and the `ModusToolbox Programming Tools`_ packages include Infineon OpenOCD.
Installing either of these packages will also install Infineon OpenOCD.

If neither package is installed, a minimal installation can be done by downloading the `Infineon OpenOCD`_ release for your system and manually extract the files to a location of your choice.

.. note:: Linux requires device access rights to be set up for KitProg3. This is handled automatically by the ModusToolbox and ModusToolbox Programming Tools installations. When doing a minimal installation, this can be done manually by executing the script ``openocd/udev_rules/install_rules.sh``.

West Commands
=============

The path to the installed Infineon OpenOCD executable must be available to the ``west`` tool commands. There are multiple ways of doing this. The example below uses a permanent CMake argument to set the CMake variable ``OPENOCD``.

   .. tabs::
      .. group-tab:: Windows

         .. code-block:: shell

            # Run west config once to set permanent CMake argument
            west config build.cmake-args -- -DOPENOCD=path/to/infineon/openocd/bin/openocd.exe

            # Do a pristine build once after setting CMake argument
            west build -b cytvii-b-h-8m-320-cpu/cyt4bfcche/m0p -p always samples/basic/blinky

            west flash
            west debug

      .. group-tab:: Linux

         .. code-block:: shell

            # Run west config once to set permanent CMake argument
            west config build.cmake-args -- -DOPENOCD=path/to/infineon/openocd/bin/openocd

            # Do a pristine build once after setting CMake argument
            west build -b cytvii-b-h-8m-320-cpu/cyt4bfcche/m0p -p always samples/basic/blinky

            west flash
            west debug

Once the gdb console starts after executing the west debug command, you may now set breakpoints and perform other standard GDB debugging.

References
**********

.. target-notes::

.. _T2G_B_H SoC Website:
    https://www.infineon.com/products/microcontroller/32-bit-traveo-t2g-arm-cortex/for-body/t2g-cyt4bf

.. _cytvii-b-h-8m-320-cpu Board Website:
    https://www.infineon.com/evaluation-board/cytvii-b-h-8m-320-cpu

.. _ModusToolbox:
    https://softwaretools.infineon.com/tools/com.ifx.tb.tool.modustoolbox

.. _ModusToolbox Programming Tools:
    https://softwaretools.infineon.com/tools/com.ifx.tb.tool.modustoolboxprogtools

.. _Infineon OpenOCD:
    https://github.com/Infineon/openocd/releases/latest

.. _KitProg4:
    https://github.com/Infineon/KitProg4
