/*
 * Copyright (c) 2026 Infineon Technologies AG
 * SPDX-License-Identifier: Apache-2.0
 */

#include <arm/infineon/cat1c/traveo2-8m/cyt4bf8cds.dtsi>
#include <zephyr/dt-bindings/input/input-event-codes.h>
#include <zephyr/dt-bindings/pinctrl/ifx_cat1-pinctrl.h>
#include <zephyr/dt-bindings/pwm/pwm.h>
#include <arm/infineon/cat1c/traveo2-8m/system_clocks.dtsi>
#include <common/freq.h>
#include <dt-bindings/adc/adc.h>

#include "kit_t2g-b-h_lite_pinctrl.dtsi"

/ {
	aliases {
		uart-0 = &uart0;
		led0 = &user_led1;
		led1 = &user_led2;
		led2 = &user_led3;
		sw0 = &user_bt1;
		sw1 = &user_bt2;
		watchdog0= &watchdog0;
		dma0=&dma0;
		adc0=&adc0;
	};

	leds {
		compatible = "gpio-leds";
		user_led1: user_led1 {
			label = "LED_1";
			gpios = <&gpio_prt5 0 GPIO_ACTIVE_HIGH>;
		};
		user_led2: user_led2 {
			label = "LED_2";
			gpios = <&gpio_prt5 1 GPIO_ACTIVE_HIGH>;
		};
		user_led3: user_led3 {
			label = "LED_3";
			gpios = <&gpio_prt5 2 GPIO_ACTIVE_HIGH>;
		};
	};

	gpio_keys {
		compatible = "gpio-keys";

		user_bt1: user_btn1 {
			label = "SW_1";
			gpios = <&gpio_prt5 3 GPIO_ACTIVE_LOW>;
			zephyr,code = <INPUT_KEY_0>;
		};
		user_bt2: user_btn2 {
			label = "SW_2";
			gpios = <&gpio_prt17 0 GPIO_ACTIVE_LOW>;
			zephyr,code = <INPUT_KEY_1>;
		};
	};

	reserved-memory {
		#address-cells = <1>;
		#size-cells = <1>;
		sram_srom: memory@28000000 {
			reg = <0x28000000 DT_SIZE_K(2)>;
		};
		sram_m0plus: memory@28000800 {
			reg = <0x28000800 DT_SIZE_K(30)>;
		};
		sram_m7_0: memory@28008000 {
			reg = <0x28008000 DT_SIZE_K(224)>;
		};
		sram_m7_1: memory@28040000 {
			reg = <0x28040000 DT_SIZE_K(256)>;
		};
	};
};

&code_flash0 {
	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		m0p_partition: partition_m0p@0 {
			label = "m0p_partition";
			reg = <0x0 DT_SIZE_K(512)>;
			status = "disabled";
		};
		m7_0_partition: partition@80000 {
			label = "m7_0_partition";
			reg = <0x80000 DT_SIZE_K(2656)>;
		};
		m7_1_partition: partition@318000 {
			label = "m7_1_partition";
			reg = <0x318000 DT_SIZE_K(3168)>;
		};
	};
};

uart0: &scb0 {
	compatible = "infineon,cat1-uart-pdl";
	current-speed = <115200>;
	clocks = <&clk_hf2>;
	ifx,peri-group = <IFX_PERI_GRP_INST_SEL(1, 0)>;
	ifx,peri-clk = <0x011E>;
	ifx,peri-div = <0>; /* 8-bit divider */
	ifx,peri-div-inst = <0>;

	/* UART pins */
	pinctrl-0 = <&p0_0_scb0_uart_rx &p0_1_scb0_uart_tx>;
	pinctrl-names = "default";
};

&pinctrl {
	/omit-if-no-ref/ p12_0_can0_0_tx: p12_0_can0_0_tx {
		pinmux = <DT_CAT1_PINMUX(5, 0, HSIOM_SEL_ACT_13)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p12_1_can0_0_rx: p12_1_can0_0_rx {
		pinmux = <DT_CAT1_PINMUX(5, 1, HSIOM_SEL_ACT_13)>;
		input-enable;
	};

	/omit-if-no-ref/ p18_0_eth_ref_clk: p18_0_eth_ref_clk {
		pinmux = <DT_CAT1_PINMUX(18, 0, HSIOM_SEL_ACT_12)>;
		input-enable;
	};
	/omit-if-no-ref/ p18_4_eth_txd_0: p18_4_eth_txd_0 {
		pinmux = <DT_CAT1_PINMUX(18, 4, HSIOM_SEL_ACT_12)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p18_5_eth_txd_1: p18_5_eth_txd_1 {
		pinmux = <DT_CAT1_PINMUX(18, 5, HSIOM_SEL_ACT_12)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p18_1_eth_tx_en: p18_1_eth_tx_en {
		pinmux = <DT_CAT1_PINMUX(18, 1, HSIOM_SEL_ACT_12)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p19_0_eth_rxd_0: p19_0_eth_rxd_0 {
		pinmux = <DT_CAT1_PINMUX(19, 0, HSIOM_SEL_ACT_12)>;
		input-enable;
	};
	/omit-if-no-ref/ p19_1_eth_rxd_1: p19_1_eth_rxd_1 {
		pinmux = <DT_CAT1_PINMUX(19, 1, HSIOM_SEL_ACT_12)>;
		input-enable;
	};
	/omit-if-no-ref/ p21_5_eth_rx_ctl: p21_5_eth_rx_ctl {
		pinmux = <DT_CAT1_PINMUX(21, 5, HSIOM_SEL_ACT_12)>;
		input-enable;
	};
	/omit-if-no-ref/ p3_1_eth_mdc: p3_1_eth_mdc {
		pinmux = <DT_CAT1_PINMUX(3, 1, HSIOM_SEL_ACT_12)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p3_0_eth_mdio: p3_0_eth_mdio {
		pinmux = <DT_CAT1_PINMUX(3, 0, HSIOM_SEL_ACT_12)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p6_3_smif0_clk: p6_3_smif0_clk {
		pinmux = <DT_CAT1_PINMUX(6, 3, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p6_5_smif0_sel0: p6_5_smif0_sel0 {
		pinmux = <DT_CAT1_PINMUX(6, 5, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p7_0_smif0_sel1: p7_0_smif0_sel1 {
		pinmux = <DT_CAT1_PINMUX(7, 0, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
	};
	/omit-if-no-ref/ p7_1_smif0_data0: p7_1_smif0_data0 {
		pinmux = <DT_CAT1_PINMUX(7, 1, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p7_2_smif0_data1: p7_2_smif0_data1 {
		pinmux = <DT_CAT1_PINMUX(7, 2, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p7_3_smif0_data2: p7_3_smif0_data2 {
		pinmux = <DT_CAT1_PINMUX(7, 3, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p7_4_smif0_data3: p7_4_smif0_data3 {
		pinmux = <DT_CAT1_PINMUX(7, 4, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p7_5_smif0_data4: p7_5_smif0_data4 {
		pinmux = <DT_CAT1_PINMUX(7, 5, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p8_0_smif0_data5: p8_0_smif0_data5 {
		pinmux = <DT_CAT1_PINMUX(8, 0, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p8_1_smif0_data6: p8_1_smif0_data6 {
		pinmux = <DT_CAT1_PINMUX(8, 1, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
	/omit-if-no-ref/ p8_2_smif0_data7: p8_2_smif0_data7 {
		pinmux = <DT_CAT1_PINMUX(8, 2, HSIOM_SEL_ACT_11)>;
		drive-push-pull;
		input-enable;
	};
};

can0: &can0_0 {
	compatible = "infineon,cat1-can";
	clocks = <&clk_hf2>;
	clock-frequency = <40000000>;
	ifx,peri-group = <IFX_PERI_GRP_INST_SEL(1, 0)>;
	ifx,peri-clk = <0x0100>;
	ifx,peri-div = <3>; /* 24-bit divider */
	ifx,peri-div-inst = <0>;

	pinctrl-0 = <&p12_0_can0_0_tx &p12_1_can0_0_rx>;
	pinctrl-names = "default";
};

spi1: &scb3 {
    compatible = "infineon,cat1-spi-pdl";
    status = "okay";

    #address-cells = <1>;
    #size-cells = <0>;

    /* SPI pins */
    pinctrl-0 = <&p13_0_scb3_spi_m_miso &p13_1_scb3_spi_m_mosi &p13_2_scb3_spi_m_clk>;
    pinctrl-names = "default";
    cs-gpios = <&gpio_prt13 3 GPIO_ACTIVE_LOW>;

    ifx,peri-group = <IFX_PERI_GRP_INST_SEL(1, 0)>;
    ifx,peri-clk = <0x0108>;
    ifx,peri-div = <1>; /* 16-bit divider */
    ifx,peri-div-inst = <3>;

	w25q128jvsq2449_spi: spi-nor-flash@0 {
		compatible = "jedec,spi-nor";
		status = "okay";
		reg = <0>;
		spi-max-frequency = <DT_FREQ_M(8)>;
		size = <DT_SIZE_M(128)>; /* 64 Mbits */
		jedec-id = [ef 40 18];
	};
};

&adc0 {
       status = "okay";
       clock-frequency = <26670000>;
       ifx,peri-group = <IFX_PERI_GRP_INST_SEL(1, 0)>;
       ifx,peri-clk = <0x0114>;
       ifx,peri-div = <0>; /* 8-bit divider */
       ifx,peri-div-inst = <2>;
};

&eth0_mac {
	pinctrl-0 = <&p18_4_eth_txd_0 &p18_5_eth_txd_1 &p18_0_eth_ref_clk
	&p18_1_eth_tx_en &p19_0_eth_rxd_0 &p19_1_eth_rxd_1
	&p21_5_eth_rx_ctl>;
	pinctrl-names = "default";
	phy-connection-type = "rmii";

	phy-handle = <&eth0_phy>;
	clock-frequency = <50000000>;
	local-mac-address = [ b0 19 21 67 36 00  ];
};

&eth0_mdio {
	pinctrl-0 = <&p3_1_eth_mdc &p3_0_eth_mdio>;
	pinctrl-names = "default";
	eth0_phy: phy@0 {
		compatible = "ethernet-phy";
		reg = <0x0>;
		status = "okay";
	};
};

&smif0 {
	status = "okay";
	pinctrl-0 = <
	&p6_3_smif0_clk &p6_5_smif0_sel0 &p7_1_smif0_data0
	&p7_2_smif0_data1 &p7_3_smif0_data2 &p7_4_smif0_data3
	&p7_5_smif0_data4 &p8_0_smif0_data5 &p8_1_smif0_data6
	&p8_2_smif0_data7 &p7_0_smif0_sel1
	>;
	pinctrl-names = "default";

	hyperflash0: hyperflash0@0 {
		compatible = "soc-nv-flash";
		reg = <0x00000000 DT_SIZE_M(512)>;
		write-block-size = <256>;
		erase-block-size = <4096>;

		partitions {
			#address-cells = <1>;
			#size-cells = <1>;
			compatible = "fixed-partitions";
		};
	};
	hyperflash1: hyperflash0@1 {
		compatible = "soc-nv-flash";
		reg = <0x00000000 DT_SIZE_M(512)>;
		write-block-size = <256>;
		erase-block-size = <4096>;

		partitions {
			#address-cells = <1>;
			#size-cells = <1>;
			compatible = "fixed-partitions";
		};
	};
};


&gpio_prt0 {
	status = "okay";
};

&gpio_prt1 {
	status = "okay";
};

&gpio_prt2 {
	status = "okay";
};

&gpio_prt3 {
	status = "okay";
};

&gpio_prt5 {
	status = "okay";
};

&gpio_prt6 {
	status = "okay";
};

&gpio_prt7 {
	status = "okay";
};

&gpio_prt8 {
	status = "okay";
};

&gpio_prt12 {
	status = "okay";
};

&gpio_prt13 {
	status = "okay";
};

&gpio_prt14 {
	status = "okay";
};

&clk_eco {
	status = "okay";
	clock-frequency = <16000000>;
};

&pll0 {
	status = "okay";
};
&pll1 {
	status = "okay";
};
&pll2 {
	status = "okay";
};


&clk_hf0 {
	status = "okay";
};
&clk_hf1 {
	status = "okay";
};
&clk_hf2 {
	status = "okay";
};
&clk_hf3 {
	status = "okay";
};
&clk_hf4 {
	status = "okay";
};
&clk_hf5 {
	status = "okay";
};
&clk_hf6 {
	status = "okay";
};
&clk_hf7 {
	status = "disabled";
};
